From 52ecdae31de3069e80870df16c1de27ce5f5c4ec Mon Sep 17 00:00:00 2001
From: Michael Kruse <llvm-project@meinersbur.de>
Date: Mon, 9 Dec 2024 15:59:36 +0100
Subject: [PATCH 3/3] Link FortranSupport

everywhere where FortranCommon is
---
 flang/lib/Optimizer/OpenMP/CMakeLists.txt |  1 +
 flang/lib/Optimizer/Passes/CMakeLists.txt |  4 +---
 flang/tools/bbc/CMakeLists.txt            |  1 +
 flang/tools/f18-parse-demo/CMakeLists.txt |  1 +
 flang/tools/tco/CMakeLists.txt            |  1 +
 flang/unittests/Evaluate/CMakeLists.txt   | 14 ++++++++------
 flang/unittests/Frontend/CMakeLists.txt   |  1 +
 7 files changed, 14 insertions(+), 9 deletions(-)

diff --git a/flang/lib/Optimizer/OpenMP/CMakeLists.txt b/flang/lib/Optimizer/OpenMP/CMakeLists.txt
index 51ecbe1a664f..1192403dd1c6 100644
--- a/flang/lib/Optimizer/OpenMP/CMakeLists.txt
+++ b/flang/lib/Optimizer/OpenMP/CMakeLists.txt
@@ -21,6 +21,7 @@ add_flang_library(FlangOpenMPTransforms
   FIRDialectSupport
   FIRSupport
   FortranCommon
+  FortranSupport
   MLIRFuncDialect
   MLIROpenMPDialect
   HLFIRDialect
diff --git a/flang/lib/Optimizer/Passes/CMakeLists.txt b/flang/lib/Optimizer/Passes/CMakeLists.txt
index 40abbdfbdd65..029588dc7f7b 100644
--- a/flang/lib/Optimizer/Passes/CMakeLists.txt
+++ b/flang/lib/Optimizer/Passes/CMakeLists.txt
@@ -5,9 +5,6 @@ add_flang_library(flangPasses
   CommandLineOpts.cpp
   Pipelines.cpp
 
-  DEPENDS
-  FortranCommon
-
   LINK_LIBS
   FIRCodeGen
   FIRTransforms
@@ -15,6 +12,7 @@ add_flang_library(flangPasses
   ${dialect_libs}
   ${extension_libs}
   FortranCommon
+  FortranSupport
   HLFIRTransforms
   MLIRPass
   MLIRReconcileUnrealizedCasts
diff --git a/flang/tools/bbc/CMakeLists.txt b/flang/tools/bbc/CMakeLists.txt
index 9abdcf17b6eb..a608d472fd99 100644
--- a/flang/tools/bbc/CMakeLists.txt
+++ b/flang/tools/bbc/CMakeLists.txt
@@ -33,6 +33,7 @@ target_link_libraries(bbc PRIVATE
   MLIRAffineToStandard
   MLIRSCFToControlFlow
   FortranCommon
+  FortranSupport
   FortranParser
   FortranEvaluate
   FortranSemantics
diff --git a/flang/tools/f18-parse-demo/CMakeLists.txt b/flang/tools/f18-parse-demo/CMakeLists.txt
index df1f1d24a55e..800b29fcf425 100644
--- a/flang/tools/f18-parse-demo/CMakeLists.txt
+++ b/flang/tools/f18-parse-demo/CMakeLists.txt
@@ -12,5 +12,6 @@ add_flang_tool(f18-parse-demo
 target_link_libraries(f18-parse-demo
   PRIVATE
   FortranCommon
+  FortranSupport
   FortranParser
   )
diff --git a/flang/tools/tco/CMakeLists.txt b/flang/tools/tco/CMakeLists.txt
index aac80437ee11..4d05ba5d1f90 100644
--- a/flang/tools/tco/CMakeLists.txt
+++ b/flang/tools/tco/CMakeLists.txt
@@ -20,6 +20,7 @@ target_link_libraries(tco PRIVATE
   flangPasses
   FlangOpenMPTransforms
   FortranCommon
+  FortranSupport
   ${dialect_libs}
   ${extension_libs}
   MLIRIR
diff --git a/flang/unittests/Evaluate/CMakeLists.txt b/flang/unittests/Evaluate/CMakeLists.txt
index 0339098df455..49f0d06d5325 100644
--- a/flang/unittests/Evaluate/CMakeLists.txt
+++ b/flang/unittests/Evaluate/CMakeLists.txt
@@ -27,6 +27,7 @@ add_flang_nongtest_unittest(uint128
 
 add_flang_nongtest_unittest(expression
   FortranCommon
+  FortranSupport
   FortranEvaluateTesting
   FortranEvaluate
   FortranSemantics
@@ -41,16 +42,16 @@ add_flang_nongtest_unittest(integer
 
 add_flang_nongtest_unittest(intrinsics
   FortranCommon
-  FortranEvaluateTesting
-  FortranEvaluate
   FortranSupport
+  FortranEvaluate
+  FortranEvaluateTesting
   FortranSemantics
   FortranParser
 )
 
 add_flang_nongtest_unittest(logical
-  FortranEvaluateTesting
   FortranEvaluate
+  FortranEvaluateTesting
   FortranSemantics
 )
 
@@ -61,16 +62,17 @@ add_flang_nongtest_unittest(logical
 set(LLVM_REQUIRES_EH ON)
 set(LLVM_REQUIRES_RTTI ON)
 add_flang_nongtest_unittest(real
-  FortranEvaluateTesting
-  FortranEvaluate
   FortranSupport
+  FortranEvaluate
+  FortranEvaluateTesting
   FortranSemantics
 )
 llvm_update_compile_flags(real.test)
 
 add_flang_nongtest_unittest(folding
   FortranCommon
-  FortranEvaluateTesting
+  FortranSupport
   FortranEvaluate
+  FortranEvaluateTesting
   FortranSemantics
 )
diff --git a/flang/unittests/Frontend/CMakeLists.txt b/flang/unittests/Frontend/CMakeLists.txt
index 22c568af3d12..a4a18e313c1f 100644
--- a/flang/unittests/Frontend/CMakeLists.txt
+++ b/flang/unittests/Frontend/CMakeLists.txt
@@ -19,6 +19,7 @@ target_link_libraries(FlangFrontendTests
   FortranParser
   FortranSemantics
   FortranCommon
+  FortranSupport
   FortranEvaluate
   MLIRIR
 )
